# go-yfinance v1.1.0 개발 진행 상황

> 마지막 업데이트: 2026-01-26

## 개요

Python yfinance v1.1.0과 동등한 데이터 품질을 제공하기 위한 Price Repair 시스템 구현

## 브랜치 구조

```
main
 └── dev
      └── feature/v1.1.0-update          ← 1.1.0 통합 브랜치 (모든 Phase 머지 완료)
           ├── feature/v1.1.0-phase1     ← ✅ 완료 및 머지
           ├── feature/v1.1.0-phase2     ← ✅ 완료 및 머지
           ├── feature/v1.1.0-phase3     ← ✅ 완료 및 머지
           ├── feature/v1.1.0-phase4     ← ✅ 완료 및 머지
           └── feature/v1.1.0-phase5     ← ✅ 완료 및 머지
```

---

## Phase 1: 기반 구축 (완료)

**목표:** 통계 패키지 및 기본 구조 생성

### 작업 항목

| 항목 | 상태 | 비고 |
|------|------|------|
| `pkg/stats/` 패키지 생성 | ✅ 완료 | |
| - percentile.go | ✅ 완료 | Percentile, IQR, Mean, Std, Median |
| - zscore.go | ✅ 완료 | Z-score, Rolling Mean/Std |
| - filter.go | ✅ 완료 | MedianFilter, MedianFilter2D, OutlierMask |
| - stats_test.go | ✅ 완료 | 20+ 테스트 케이스 |
| `pkg/repair/` 패키지 구조 | ✅ 완료 | |
| - doc.go | ✅ 완료 | 패키지 문서 |
| - repair.go | ✅ 완료 | Repairer, Options, 플레이스홀더 |
| `models/history.go` 수정 | ✅ 완료 | CapitalGains, Repaired, RepairOptions |
| `ticker/history.go` 수정 | ✅ 완료 | Capital Gains 파싱 |
| MkDocs 문서 업데이트 | ✅ 완료 | advanced/price-repair.md |
| Phase 1 머지 | ✅ 완료 | → feature/v1.1.0-update (2026-01-26) |

### 변경 파일

```
pkg/
├── stats/                    ← 신규
│   ├── doc.go
│   ├── percentile.go
│   ├── zscore.go
│   ├── filter.go
│   └── stats_test.go
├── repair/                   ← 신규
│   ├── doc.go
│   └── repair.go
└── models/
    └── history.go            ← 수정
```

---

## Phase 2: 핵심 Repair (완료)

**목표:** Capital Gains 및 Stock-Split Repair 구현

### 작업 항목

| 항목 | 상태 | 비고 |
|------|------|------|
| `repair/capital_gains.go` | ✅ 완료 | 이중계산 탐지 및 수정 |
| `repair/split.go` | ✅ 완료 | IQR 기반 탐지, 분할 수정 |
| 테스트 fixtures | ✅ 완료 | 18+ 테스트 케이스 |
| MkDocs 문서 | ✅ 완료 | advanced/price-repair.md |
| Phase 2 머지 | ✅ 완료 | → feature/v1.1.0-update (2026-01-26) |

---

## Phase 3: 고급 Repair (완료)

**목표:** Unit Mixup 및 Zero Value Repair

### 작업 항목

| 항목 | 상태 | 비고 |
|------|------|------|
| `repair/unit_mixup.go` | ✅ 완료 | 100x 통화 오류 ($/cents, £/pence) |
| `repair/zeroes.go` | ✅ 완료 | 누락/0값 수정 |
| `repair/unit_mixup_test.go` | ✅ 완료 | 15+ 테스트 케이스 |
| `repair/zeroes_test.go` | ✅ 완료 | 15+ 테스트 케이스 |
| Phase 3 머지 | ✅ 완료 | → feature/v1.1.0-update (2026-01-26) |

### 변경 파일

```
pkg/repair/
├── unit_mixup.go        ← 신규 (Random mixups, Unit switch 탐지/수정)
├── unit_mixup_test.go   ← 신규
├── zeroes.go            ← 신규 (Zero/NaN 탐지/수정)
├── zeroes_test.go       ← 신규
└── repair.go            ← 수정 (placeholder 제거)
```

### 알고리즘 상세

**Unit Mixup Repair:**
1. Random 100x 오류: 2D MedianFilter로 ~100x 값 탐지
2. Unit Switch: IQR 기반 갑작스러운 100x 가격 변화 탐지
3. KWF (쿠웨이트 디나르) 특별 처리 (1000 단위)

**Zero Value Repair:**
1. 거래가 발생한 Zero bar 탐지 (Volume > 0, Splits, Dividends)
2. 이웃 bar 기반 보간 (Forward fill, Backward fill)
3. 부분 Zero 수정 (일부 OHLC만 0인 경우)

---

## Phase 4: 배당금 Repair (완료)

**목표:** Dividend Repair 구현

### 작업 항목

| 항목 | 상태 | 비고 |
|------|------|------|
| `repair/dividend.go` | ✅ 완료 | 배당 조정 오류 수정 |
| `repair/dividend_test.go` | ✅ 완료 | 27+ 테스트 케이스 |
| Phase 4 머지 | ✅ 완료 | → feature/v1.1.0-update (2026-01-26) |

### 변경 파일

```
pkg/repair/
├── dividend.go          ← 신규 (배당 분석 및 수정)
├── dividend_test.go     ← 신규
└── repair.go            ← 수정 (placeholder 제거)
```

### 알고리즘 상세

**Dividend Repair:**
1. Missing Adjustment: Adj Close = Close인 경우 탐지 및 수정
2. Too Large (100x): 배당금 통화 단위 오류 (100배 크게)
3. Too Small (0.01x): 배당금 통화 단위 오류 (100배 작게)
4. Phantom Detection: 7-17일 내 중복 배당 탐지
5. Window Volatility: 주변 가격 변동성 기반 오류 판별

---

## Phase 5: MIC 매핑 및 마무리 (완료)

**목표:** MIC 코드 지원 및 최종 정리

### 작업 항목

| 항목 | 상태 | 비고 |
|------|------|------|
| `pkg/utils/mic.go` | ✅ 완료 | ISO 10383 MIC 코드 매핑 (60+ 거래소) |
| `pkg/utils/mic_test.go` | ✅ 완료 | 10 테스트 케이스 |
| 최종 문서화 | ⬜ 대기 | MkDocs 업데이트 |
| v1.1.0 릴리스 노트 | ⬜ 대기 | RELEASE_NOTES |
| Phase 5 머지 | ✅ 완료 | → feature/v1.1.0-update (2026-01-26) |

### 변경 파일

```
pkg/utils/
├── mic.go          ← 신규 (MIC↔Yahoo Suffix 매핑)
└── mic_test.go     ← 신규 (10 테스트 케이스)
```

### 주요 기능

**MIC 코드 매핑:**
- `MICToYahooSuffix`: ISO 10383 MIC → Yahoo Finance suffix
- `YahooSuffixToMIC`: Yahoo suffix → MIC (역매핑)
- `GetYahooSuffix(mic)`: MIC에서 suffix 조회
- `GetMIC(suffix)`: Suffix에서 MIC 조회
- `FormatYahooTicker(base, mic)`: "AAPL" + "XLON" → "AAPL.L"
- `ParseYahooTicker(ticker)`: "AAPL.L" → ("AAPL", "L")
- `IsUSExchange(mic)`: 미국 거래소 여부 확인
- `AllMICs()`: 지원하는 모든 MIC 코드 목록
- `AllYahooSuffixes()`: 지원하는 모든 Yahoo suffix 목록

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-01-26 | 브랜치 구조 설정, Phase 1 시작 |
| 2026-01-26 | Phase 1 완료 및 머지, Phase 2 시작 |
| 2026-01-26 | Phase 2 완료 및 머지 (Capital Gains, Stock Split Repair) |
| 2026-01-26 | Phase 3 완료 및 머지 (Unit Mixup, Zero Value Repair) |
| 2026-01-26 | Phase 4 완료 및 머지 (Dividend Repair) |
| 2026-01-26 | Phase 5 완료 및 머지 (MIC 코드 매핑) |
